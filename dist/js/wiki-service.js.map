{"version":3,"sources":["wiki-service.ts"],"names":["SearchResult","SearchResult.constructor","WikiService","WikiService.constructor","WikiService.wikiSearch","WikiService.generateSuggestions","WikiService.showResults","WikiService.parseResults","WikiService.clearResults"],"mappings":"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","file":"wiki-service.js","sourcesContent":["import { Jsonp, Response } from 'angular2/http';\r\nimport * as Rx from 'rxjs/Rx';\r\nimport { Injectable } from 'angular2/core';\r\n\r\nexport class SearchResult {\r\n\tname: string;\r\n\tdescription: string;\r\n\turl: string;\r\n}\r\n\r\n@Injectable()\r\nexport class WikiService {\r\n\tbaseUrl = 'https://en.wikipedia.org/w/api.php?action=opensearch&limit=10&format=json&callback=JSONP_CALLBACK&search=';\r\n\t\r\n\tsuggestions: string[] = [];\r\n\tqueryStream = new (<any>Rx).Subject();\r\n\tresultStream = new (<any>Rx).Observable();\r\n\tpendingQuery = false;\r\n\tresultBuffer: any;\r\n\tresults: SearchResult[] = [];\r\n\r\n\tconstructor(public jsonp: Jsonp) {\r\n\t\tthis.resultStream = this.queryStream\r\n\t\t\t\t\t\t\t\t.debounceTime(250)\r\n\t\t\t\t\t\t\t\t.switchMap( query => this.wikiSearch(query) );\r\n\t\tthis.resultStream.subscribe(\r\n\t\t\t\tresults  => {\r\n\t\t\t\t\tthis.pendingQuery = false;\r\n\t\t\t\t\tthis.resultBuffer = results; // Save the result in case we decide to view results on this query\r\n\t\t\t\t\tlet resSuggests: string[] = results[1];\r\n\t\t\t\t\tthis.suggestions = resSuggests.slice();  // We prefer a copy to a reference\r\n\t\t\t\t},\r\n\t\t\t\terror => console.log (error)\r\n\t\t\t);\r\n\t}\r\n\t\r\n\twikiSearch(query: string): Rx.Observable<any> {\r\n\t\tthis.pendingQuery = true;\r\n\t\treturn this.jsonp.request( `${this.baseUrl}${query}` ).map( (res: Response) => <any>res.json() );\r\n\t}\r\n\t\r\n\tgenerateSuggestions(query: string) {\r\n\t\tthis.queryStream.next(query);\r\n\t}\r\n\t\r\n\tshowResults() {\r\n\t\tif (!this.pendingQuery && this.resultBuffer) {\r\n\t\t\tconsole.log('no pending query');\r\n\t\t\tthis.parseResults();\r\n\t\t}\r\n\t}\r\n\t\r\n\tparseResults() {\r\n\t\tthis.suggestions = [];\r\n\t\tthis.results = [];\r\n\t\tlet resultNames = this.resultBuffer[1];\r\n\t\tlet resultDescriptions = this.resultBuffer[2];\r\n\t\tlet resultUrls = this.resultBuffer[3];\r\n\t\t\r\n\t\tfor (let i=0; i < resultNames.length; i++) {\r\n\t\t\tlet result = new SearchResult();\r\n\t\t\tresult.name = resultNames[i];\r\n\t\t\tresult.description = resultDescriptions[i];\r\n\t\t\tresult.url = resultUrls[i];\r\n\t\t\tthis.results.push(result);\t\t\r\n\t\t}\r\n\t\tthis.resultBuffer = null;\r\n\t}\r\n\t\r\n\tclearResults() {\r\n\t\tthis.suggestions = [];\r\n\t\tthis.results = [];\r\n\t\tthis.resultBuffer = null;\r\n\t}\r\n\r\n\r\n}"],"sourceRoot":"/source/"}